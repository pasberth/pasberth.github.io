$(BUILDDIR)/index.html: $(BUILDDIR) main.html index.html.erb
    env X=30 Y=30 erb index.html.erb > $(BUILDDIR)/index.html

$(BUILDDIR)/css/main.css: $(BUILDDIR)/css main.css
    cp main.css $(BUILDDIR)/css/main.css

$(BUILDDIR)/css/lifegame.css: $(BUILDDIR)/css lifegame.css.erb
    env X=30 Y=30 erb lifegame.css.erb > $(BUILDDIR)/css/lifegame.css

$(BUILDDIR)/css/lifegame-ball.css: $(BUILDDIR)/css lifegame-ball.css
    cp lifegame-ball.css $(BUILDDIR)/css

$(BUILDDIR)/css/lifegame-ring.css: $(BUILDDIR)/css lifegame-ring.css
    cp lifegame-ring.css $(BUILDDIR)/css

$(BUILDDIR)/css/lifegame-classic.css: $(BUILDDIR)/css lifegame-classic.css
    cp lifegame-classic.css $(BUILDDIR)/css

$(BUILDDIR)/usercss: lifegame-ball.css lifegame-ring.css lifegame-classic.css
    mkdir -p $(BUILDDIR)/usercss
    foreach (css, lifegame-ball.css lifegame-ring.css lifegame-classic.css)
        sed "s/;/ !important;/" $(css) > $(BUILDDIR)/usercss/$(css)

$(BUILDDIR)/coffee/index.coffee: $(BUILDDIR)/coffee index.coffee.erb
    env X=30 Y=30 erb index.coffee.erb > $(BUILDDIR)/coffee/index.coffee

$(BUILDDIR)/js/index.js: $(BUILDDIR)/js $(BUILDDIR)/coffee/index.coffee
    coffee -o $(BUILDDIR)/js -c $(BUILDDIR)/coffee/index.coffee

build: $(BUILDDIR)/index.html \
       $(BUILDDIR)/css/main.css \
       $(BUILDDIR)/css/lifegame.css \
       $(BUILDDIR)/css/lifegame-ball.css \
       $(BUILDDIR)/css/lifegame-ring.css \
       $(BUILDDIR)/css/lifegame-classic.css \
       $(BUILDDIR)/usercss \
       $(BUILDDIR)/js/index.js

clean: build
    rm $(BUILDDIR)/index.html
    rm $(BUILDDIR)/css/main.css
    rm $(BUILDDIR)/css/lifegame.css
    rm $(BUILDDIR)/css/lifegame-ball.css
    rm $(BUILDDIR)/css/lifegame-ring.css
    rm $(BUILDDIR)/css/lifegame-classic.css
    rm $(BUILDDIR)/usercss/lifegame-ball.css
    rm $(BUILDDIR)/usercss/lifegame-ring.css
    rm $(BUILDDIR)/usercss/lifegame-classic.css
    rmdir $(BUILDDIR)/usercss
    rm $(BUILDDIR)/js/index.js
    rm $(BUILDDIR)/coffee/index.coffee