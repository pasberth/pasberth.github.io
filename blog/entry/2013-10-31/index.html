<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    
      <title>fish Friendly Interactive SHell</title>
    

    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
</head>
<body>

    <div class="body">
        
  <div class="section" id="fish-friendly-interactive-shell">
<h1>fish Friendly Interactive SHell<a class="headerlink" href="#fish-friendly-interactive-shell" title="Permalink to this headline">¶</a></h1>
<p>fish というシェルを使ってみた．なかなかいい感じの使い心地だ．
インストールしたとき，はじめから， Zsh でいう，
<a class="reference external" href="https://github.com/zsh-users/zsh-syntax-highlighting">zsh-syntax-highlighting</a>
や
<a class="reference external" href="https://github.com/zsh-users/zsh-history-substring-search">zsh-history-substring-search</a>
相当の機能が入っている．補完も敏感で，最初からいろいろと補完できる．</p>
<p><a class="reference external" href="http://fishshell.com/docs/current/tutorial.html">チュートリアル</a> を読もう．
構文はちょっと独特で，たとえば bash なら</p>
<div class="code highlight-python"><pre>echo $(pwd)</pre>
</div>
<p>と書く所を， fish では</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="n">echo</span> <span class="p">(</span><span class="n">pwd</span><span class="p">)</span>
</pre></div>
</div>
<p>のように書く．他にも， <tt class="docutils literal"><span class="pre">cmd</span> <span class="pre">^</span> <span class="pre">file.ext</span></tt> のようにすると標準エラー出力を
ファイルに出力するという機能があったりする． bash では</p>
<div class="code highlight-python"><pre>export HOGE=FUGA</pre>
</div>
<p>と書く所を， fish では</p>
<div class="code highlight-python"><pre>set -x HOGE FUGA</pre>
</div>
<p>と書く． <tt class="docutils literal"><span class="pre">-x</span></tt> は， <tt class="docutils literal"><span class="pre">--export</span></tt> の略だ．</p>
<p>変数は， bash では</p>
<div class="code highlight-python"><div class="highlight"><pre><span class="n">x</span><span class="o">=</span><span class="n">y</span>
</pre></div>
</div>
<p>と書く所を， fish では</p>
<div class="code highlight-python"><pre>set x y</pre>
</div>
<p>と書く．配列は， bash では</p>
<div class="code highlight-python"><pre>a=(x y z)</pre>
</div>
<p>と書く所を， fish では</p>
<div class="code highlight-python"><pre>set a x y z</pre>
</div>
<p>と書く．添字は 1 から始まる．</p>
<div class="code highlight-python"><pre>$ echo $a[1]
x
$ echo $a[2]
y
$ echo $a[3]
z</pre>
</div>
<p>さらに，配列をスライスすることも
できる．たとえば，</p>
<div class="code highlight-python"><pre>$ echo $a[1..2]
x y
$ echo $a[1..3]
x y z
$ echo $a[1..-1]
x y z
$ echo $a[1..-2]
x y</pre>
</div>
<p>プロンプトは， <tt class="docutils literal"><span class="pre">PS1</span></tt> とかいう変数ではなく，</p>
<div class="code highlight-python"><pre>function fish_prompt
  printf '%s%s : ' (prompt_pwd) (set_color normal)
end</pre>
</div>
<p>のように， <tt class="docutils literal"><span class="pre">fish_prompt</span></tt> という関数でつくる．</p>
<p>たとえば， <tt class="docutils literal"><span class="pre">~/.config/fish/functions/fish_prompt.fish</span></tt> などという
ファイルをつくって，</p>
<div class="code highlight-python"><pre>function fish_prompt
  printf '%s%s : ' (prompt_pwd) (set_color normal)
end</pre>
</div>
<p>のように書いておくと自動でロードされる．これはプロンプトの話ではなく，
自動で関数をロードするという機能らしい．</p>
<p><tt class="docutils literal"><span class="pre">.bashrc</span></tt> のような設定ファイルは， fish では <tt class="docutils literal"><span class="pre">~/.config/fish/config.fish</span></tt> に
書く．</p>
<p>すこし触ったところすごい良い感じだ．
ただちょっと問題もある．構文がシェルではないせいで，普通のシェルなら <tt class="docutils literal"><span class="pre">source</span></tt> で
評価できるスクリプトを評価したりはできない．そのため， <tt class="docutils literal"><span class="pre">hoge.sh</span></tt> みたいな設定ファイルは
軒並みお陀仏だ．自分で書いたものならいいけど，バージョン管理システムなどが要求していると
ちょっと面倒なことになると思う．ぼくは opam の使用時に問題になった．
opam は， .bashrc とかに</p>
<div class="code highlight-python"><pre>eval `opam config env`</pre>
</div>
<p>のように書いてパスを通すのだけど，これが評価できない．
opam は omake などのインストールに使用しているので，これは困る．
結局，ぼくは</p>
<div class="code highlight-python"><pre>eval (opam config env | perl -pe 's/(.*?)=(.*?);/set -x $1 $2;/; s/export (.*?);//; s/:/ /g')</pre>
</div>
<p>のように書いて回避した．</p>
</div>


    </div>

</body>
</html>