<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    
      <title>PEG.js で S式をパースする</title>
    

    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
</head>
<body>

    <div class="body">
        
  <div class="section" id="peg-js-s">
<h1>PEG.js で S式をパースする<a class="headerlink" href="#peg-js-s" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/mizchi/TypedCoffeeScript">TypedCoffeeScript</a> のコードを
読むにさしあたって PEG.js というパーサジェネレータを知った． PEG.js は， JavaScript の
コードを出力するパーサジェネレータだ．とりあえず
<a class="reference external" href="http://pegjs.majda.cz/documentation">ドキュメント</a> を読み， S式をパースする
コードを書いてみた．</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre>start
  = sexp

sexp
  = s:symbol                            { return s; }
  / &quot;(&quot; _ x:sexp _ &quot;.&quot; _ y:sexp _ &quot;)&quot;   { return [].concat([x], y); }
  / &quot;(&quot; xs:sexp_list &quot;)&quot;                { return xs; }

sexp_list
  = x:sexp ys:(_sexp*)                  {
                                            return [].concat([x], ys);
                                        }

_sexp
  = _ x:sexp                            { return x; }

symbol
  = s:([^(). \t\r\n]+)                  { return s.join(&quot;&quot;); }

_ = [ \t\r\n]*
</pre></div>
</td></tr></table></div>
<p>このコードをテストするコードも書く．</p>
<div class="highlight-js"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">sexp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./sexp&quot;</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sexp</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;(a b c)&quot;</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sexp</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s2">&quot;(define (S x y z) (x z (y z)))&quot;</span><span class="p">));</span>
</pre></div>
</td></tr></table></div>
<p>出力はこう．</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span> <span class="p">]</span>
<span class="p">[</span> <span class="s">&#39;define&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;S&#39;</span><span class="p">,</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span> <span class="p">],</span> <span class="p">[</span> <span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;z&#39;</span> <span class="p">]</span> <span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
</div>


    </div>

</body>
</html>